# Todo - JPA / Servlets / JSP

## Architecture

The project uses Jakarta EE (Servlets + JSP) with JPA (Hibernate) on PostgreSQL. The domain model is built around three entities (`User`, `Category`, `Annonce`) with the required relations (many annonces per user and per category). Persistence is configured in `persistence.xml`, and all database access goes through JPQL repositories. A service layer manages transactions and business rules (create/update/publish/archive/delete). The web layer is built with Servlets and JSP, using Bootstrap for a consistent UI. Authentication uses a session-based login with BCrypt password hashes; a global filter blocks access to all routes except login and registration. The home page centralizes navigation and category management, and forms include server-side validation with error feedback and value retention.

## Problemes rencontres

**Persistence XML version mismatch.** Hibernate failed to load `persistence.xml` with `version="3.2"` and threw an "Unrecognized JPA persistence.xml XSD version" error.

**Missing database columns for relations.** When loading annonces, Hibernate generated SQL with `author_id` and `category_id`, but those columns did not exist in the database.

**JSP duplicate variable name.** The JSP for the annonce list declared a local variable named `page`, which conflicts with the implicit JSP `page` object.

## Solutions apportees

**Persistence XML version mismatch.** The fix was to downgrade the schema to `version="3.1"` with the corresponding XSD, which Hibernate supports in the current dependency set.

**Missing database columns for relations.** The fix was to enable automatic schema update via `hibernate.hbm2ddl.auto=update` so the missing columns and constraints are created.

**JSP duplicate variable name.** The fix was to rename the local variable to `pageNumber`.

## Scripts SQL

The schema can be generated by Hibernate at runtime as `schema.sql` using the JPA schema generation properties in `src/main/resources/META-INF/persistence.xml`.

## Tests automatises

JUnit 5 and Mockito tests live under `src/test/java` and run with `./mvnw test`.
